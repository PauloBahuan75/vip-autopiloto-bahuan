<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Lista VIP • Abrir WhatsApp</title>
  </head>
  <body style="font-family: Arial, sans-serif; padding: 24px; max-width: 720px;">
    <h2>Quase lá ✅</h2>
    <p>Para continuar, clique em um dos botões abaixo para abrir o WhatsApp.</p>

    <p id="origem" style="color:#666; font-size: 13px; margin-top: 6px;"></p>

    <p>
      <a id="btnWa1" href="#" style="
        display:inline-block; padding:14px 18px; border-radius:10px;
        background:#25D366; color:#fff; text-decoration:none; font-weight:700; margin-right:10px;
      ">Abrir WhatsApp (wa.me)</a>

      <a id="btnWa2" href="#" style="
        display:inline-block; padding:14px 18px; border-radius:10px;
        background:#128C7E; color:#fff; text-decoration:none; font-weight:700;
      ">Abrir WhatsApp (api.whatsapp.com)</a>
    </p>

    <p style="margin-top:18px; color:#666;">
      Se nenhum botão funcionar, copie e cole este link no navegador:
    </p>
    <p style="word-break: break-all; background:#f6f6f6; padding:12px; border-radius:8px;">
      <span id="waLink"></span>
    </p>

    <script>
      // Apps Script (Web App) - endpoint
      const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzlSDAshFhVL0HJ1y1VTEdJVENb7QO5LSXEaCahyEsSIijVtjRVhL5RDAjCBz1uEpmn1g/exec";
      const PHONE = "5511996900033";

      const qs = new URLSearchParams(window.location.search);
      const src = qs.get("src") || "SITE";

      // ✅ Se vier page=... (ex.: clique vindo de SEO), registra essa origem
      const pageParam = qs.get("page") || "";
      const page = pageParam ? decodeURIComponent(pageParam) : window.location.href;

      document.getElementById("origem").textContent = pageParam ? `Origem (page): ${pageParam}` : `SRC: ${src}`;

      // Mensagem do WhatsApp
      const text = `Olá! Vim pela Lista VIP (SRC: ${src}). Quero opções de lançamento/em obras/pronto em São Paulo.`;

      const wa1 = `https://wa.me/${PHONE}?text=${encodeURIComponent(text)}`;
      const wa2 = `https://api.whatsapp.com/send?phone=${PHONE}&text=${encodeURIComponent(text)}`;

      // Botões
      const btn1 = document.getElementById("btnWa1");
      const btn2 = document.getElementById("btnWa2");
      btn1.href = wa1;
      btn2.href = wa2;

      // Link para copiar
      document.getElementById("waLink").textContent = wa1;

      // ✅ REGISTRO ULTRA-CONFIÁVEL (GET "pixel")
      // Evita problemas de CORS/Beacon no Edge.
      const uaShort = (navigator.userAgent || "").slice(0, 180);
      const ts = Date.now();
      const pingUrl =
        `${WEBAPP_URL}?src=${encodeURIComponent(src)}` +
        `&page=${encodeURIComponent(page)}` +
        `&ua=${encodeURIComponent(uaShort)}` +
        `&ts=${encodeURIComponent(ts)}`;

      // dispara o ping
      try {
        const img = new Image();
        img.src = pingUrl;
      } catch (e) {}

      // Navegação por clique (compatível com Edge)
      btn1.addEventListener("click", (ev) => { ev.preventDefault(); window.location.href = wa1; });
      btn2.addEventListener("click", (ev) => { ev.preventDefault(); window.location.href = wa2; });
    </script>
  </body>
</html>
